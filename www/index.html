<!DOCTYPE html>
<html>
  <head>
    <title>Capture Image</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>        
    <script src="js/jquery-1.11.2.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/porthole.js"></script>
    <script type="text/javascript" charset="utf-8">		
		
        var pictureSource;   
        var destinationType; 
        var x;
		
		

        $(document).bind('deviceready', function(){
            pictureSource=navigator.camera.PictureSourceType;
            destinationType=navigator.camera.DestinationType;                        
            getLocation();
			//window.open('http://plentyofcurry.com/apps','_self');
        });
        
        function getLocation() {
            alert("Inside getLocation");
            if (navigator.geolocation) {
                alert("Inside getLocation if");
                navigator.geolocation.getCurrentPosition(showPosition, showError, { maximumAge: 3000, timeout: 10000, enableHighAccuracy: true });
                alert("navigator.geolocation.getCurrentPosition");
            } else { 
                alert("Inside getLocation else");
                x.innerHTML = "Geolocation is not supported by this browser.";
            }
        }
        
        function showPosition(position) {
            alert("Inside showPosition");
			alert(JSON.stringify(position));
			alert(position.coords.latitude);
			alert(position.coords.longitude);
			x = document.getElementById("demo");
            x.innerHTML = "Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude;
            //alert("Latitude: " + position.coords.latitude + "<br>Longitude: " + position.coords.longitude);
        }
        
        function showError(error) {
            alert(JSON.stringify(error));
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    x.innerHTML = "User denied the request for Geolocation."
                    break;
                case error.POSITION_UNAVAILABLE:
                    x.innerHTML = "Location information is unavailable."
                    break;
                case error.TIMEOUT:
                    x.innerHTML = "The request to get user location timed out."
                    break;
                case error.UNKNOWN_ERROR:
                    x.innerHTML = "An unknown error occurred."
                    break;
            }
        }
        
        function getPhoto() 
        {
            navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 100, 
            destinationType: destinationType.DATA_URL,
            sourceType: pictureSource.PHOTOLIBRARY, targetWidth: 100,
  targetHeight: 100,encodingType: Camera.EncodingType.JPEG });
        }
		
		function capturePhoto() {			
		  // Take picture using device camera and retrieve image as base64-encoded string
		  navigator.camera.getPicture(onPhotoURISuccess, onFail, { quality: 50,
			destinationType: destinationType.DATA_URL });
		}
        
        function onPhotoURISuccess(imageURI) 
        {
            //alert(imageURI);
            var largeImage = document.getElementById('largeImage');
            largeImage.style.display = 'block';
            largeImage.src = imageURI;
            
            var imageActual = document.getElementById('myImage');
            var imgDatas = "data:image/jpeg;base64," + imageURI;
            
            alert(imgDatas);
            console.log(imgDatas);
            imageActual.src = imgDatas;
            
        }
        
        function onFail(message) 
        {
            alert('Failed because: ' + message);
        }
        
		

    </script>
	<script type="text/javascript">
			var guestDomain = 'plentyofcurry.com';
			
			function onMessage1(messageEvent) {  
				Porthole.trace("onMessage1");
				if (messageEvent.origin == "http://" + guestDomain) {
					if (messageEvent.data["color"]) {
						getPhoto();
					} 
					
					if (messageEvent.data["expanded"]) {
						capturePhoto();
					}
					
				}
			}

			
			
			
			var windowProxy1;
			window.onload=function(){ 
				Porthole.trace("onload");
					// Create a proxy window to send to and receive message from the guest iframe
					windowProxy1 = new Porthole.WindowProxy('http://' + guestDomain + '/apps/proxy.html', 'guestFrame1');
					windowProxy1.addEventListener(onMessage1);					
			};
		</script>
    </head>
    <body>
        <div data-role="page" data-theme="a">

        <div data-role="content">
		
		<!--<iframe src="http://avijitcse.netai.net" style="width:100%; height:100%"></iframe>-->		
		<div>
			<h3>Frame 1</h3>
			<iframe id="guestFrame1" name="guestFrame1" width="100%" height="100%" frameborder="0" src="http://plentyofcurry.com/apps" scrolling="no"></iframe>
		</div>		
        <button onclick="getPhoto();">From Gallery!!</button>
		<button onclick="capturePhoto();">Capture Photo</button>
		
        <div id="largeImage"></div>
        <p id="demo"></p>
        <img src id="myImage" height="100"/>
        </div>
        
        </div>
		
		<script type="text/javascript" src="http://debug.build.phonegap.com/target/target-script-min.js#3cd01486-cf39-11e4-b448-f226c22ed271"></script>
		
</html>
